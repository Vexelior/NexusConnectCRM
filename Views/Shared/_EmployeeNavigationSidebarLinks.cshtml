@using Microsoft.AspNetCore.Identity
@inject NexusConnectCRM.Data.ApplicationDbContext _context
@using System.Linq

@{
    // var userId = _context.Users.FirstOrDefault(u => u.Email == User.Identity.Name)?.CompanyId;
    // var userCompanyId = _context.Companies.FirstOrDefault(c => c.Id == userId)?.Id;
    var prospectsNeededContact = _context.Prospects.Where(p => p.IsContacted == false &&
                                                          p.Address != null &&
                                                          p.City != null &&
                                                          p.State != null &&
                                                          p.Country != null &&
                                                          p.ZipCode != null);

    int prospectsNeededContactCount = prospectsNeededContact.Count();

    var customersNeededContact = _context.Customers.Where(c => c.NeedsContact == true);
    int customersNeededContactCount = customersNeededContact.Count();

    var companiesNeededContact = _context.Companies.Where(c => c.NeedsContact == true);
    int companiesNeededContactCount = companiesNeededContact.Count();

    var totalNeededContactCount = prospectsNeededContactCount + customersNeededContactCount + companiesNeededContactCount;
}
<a class="list-group-item list-group-item-action list-group-item-light p-3" asp-controller="Employee" asp-action="Index">
    Dashboard
</a>
<a class="list-group-item list-group-item-action list-group-item-light p-3" asp-area="Identity" asp-page="/Account/Manage/Index" title="Update Profile">
    Profile
</a>
<div class="dropdown dropend">
    <button class="dropdown-toggle list-group-item list-group-item-action list-group-item-light p-3 portal-profile-edit-button" data-bs-toggle="dropdown" aria-expanded="false">
        Tasks
        @if (totalNeededContactCount > 0)
        {
            <span class="badge bg-danger rounded-pill">@totalNeededContactCount</span>
        }
    </button>
    <ul class="dropdown-menu">
        <li>
            <a class="dropdown-item" href="@Url.Action("ViewProspects", "Employee")">
                Prospects
                @if (prospectsNeededContactCount > 0)
                {
                    @if (prospectsNeededContactCount > 99)
                    {
                        <span class="badge bg-danger rounded-pill">99+</span>
                    }
                    else
                    {
                        <span class="badge bg-danger rounded-pill">@prospectsNeededContactCount</span>
                    }
                }
            </a>
        </li>
        <li>
            <a class="dropdown-item" href="@Url.Action("ViewCustomers", "Employee")">
                Customers
                @if (customersNeededContactCount > 0)
                {
                    @if (customersNeededContactCount > 99)
                    {
                        <span class="badge bg-danger rounded-pill">99+</span>
                    }
                    else
                    {
                        <span class="badge bg-danger rounded-pill">@customersNeededContactCount</span>
                    }
                }
            </a>
        </li>
        <li>
            <a class="dropdown-item" href="@Url.Action("ViewCompanies", "Employee")">
                Companies
                @if (companiesNeededContactCount > 0)
                {
                    @if (companiesNeededContactCount > 99)
                    {
                        <span class="badge bg-danger rounded-pill">99+</span>
                    }
                    else
                    {
                        <span class="badge bg-danger rounded-pill">@companiesNeededContactCount</span>
                    }
                }
            </a>
        </li>
    </ul>
</div>
<a class="list-group-item list-group-item-action list-group-item-light p-3" href="@Url.Action("Help", "Employee")">
    Help Tickets
</a>
<a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!">
    Status
</a>
<form class="form-inline" id="logoutForm" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })">
    <button type="submit" class="list-group-item list-group-item-action list-group-item-light p-3" style="width: 100%;">Logout</button>
</form>

